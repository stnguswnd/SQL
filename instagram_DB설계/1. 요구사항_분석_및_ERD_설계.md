# 📘 인스타그램 + 채팅 ERD 설계 문서

## 1. 엔티티 상세 분석

---

### 1.1. Users (사용자)

**설명:** 사용자 계정 및 프로필 정보를 저장

| 속성명 | 데이터 타입 | NULL 허용 | 제약조건 | 설명 |
|--------|-------------|-----------|-----------|------|
| user_id | INT | NO | PK, AUTO_INCREMENT | 사용자 고유 ID |
| name | VARCHAR(50) | NO | - | 사용자 이름 |
| email | VARCHAR(50) | NO | UNIQUE | 이메일 주소 |
| phone_number | VARCHAR(20) | YES | - | 전화번호 |
| password | VARCHAR(255) | NO | - | 암호화된 비밀번호 |
| profile_image | VARCHAR(255) | YES | - | 프로필 이미지 경로 |
| created_at | DATETIME | NO | DEFAULT CURRENT_TIMESTAMP | 가입일 |
| updated_at | DATETIME | NO | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 수정일 |

**비지니스 규칙:**
- 이메일은 고유값이어야 함.
- 비밀번호는 해시 저장.
- 사용자 삭제 시 관련 데이터(게시글, 댓글, 팔로우, 메시지 등)도 CASCADE로 삭제.

---

### 1.2. Posts (게시물)

**설명:** 사용자가 작성한 게시글 데이터 저장

| 속성명 | 데이터 타입 | NULL 허용 | 제약조건 | 설명 |
|--------|-------------|-----------|-----------|------|
| post_id | INT | NO | PK, AUTO_INCREMENT | 게시글 ID |
| user_id | INT | NO | FK → Users.user_id | 작성자 |
| content | TEXT | YES | - | 본문 내용 |
| created_at | DATETIME | NO | DEFAULT CURRENT_TIMESTAMP | 작성일 |
| updated_at | DATETIME | NO | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 수정일 |

**비지니스 규칙:**
- 게시물 삭제 시 댓글, 좋아요, 미디어 같은 관련 데이터도 같이 삭제.
- 최소 1개의 미디어를 포함해야 함(앱 레벨 검증).

---

### 1.3. Media (미디어)

| 속성명 | 데이터 타입 | NULL 허용 | 제약조건 | 설명 |
|--------|-------------|-----------|-----------|------|
| media_id | INT | NO | PK, AUTO_INCREMENT | 미디어 ID |
| post_id | INT | NO | FK → Posts.post_id | 게시글 ID |
| media_url | VARCHAR(255) | NO | - | 파일 경로(URL) |
| media_type | ENUM('image','video') | NO | - | 미디어 타입 |
| created_at | DATETIME | NO | DEFAULT CURRENT_TIMESTAMP | 업로드 시각 |

**비지니스 규칙:**
- 한 게시글당 최대 10개의 미디어(이미지, 영상 등)
- 게시글 삭제 시 연속 삭제.

---

### 1.4. Comments (댓글)

| 속성명 | 데이터 타입 | NULL 허용 | 제약조건 | 설명 |
|--------|-------------|-----------|-----------|------|
| comment_id | INT | NO | PK, AUTO_INCREMENT | 댓글 ID |
| user_id | INT | NO | FK → Users.user_id | 작성자 |
| post_id | INT | NO | FK → Posts.post_id | 대상 게시글 |
| content | TEXT | NO | - | 댓글 내용 |
| created_at | DATETIME | NO | DEFAULT CURRENT_TIMESTAMP | 작성일 |
| updated_at | DATETIME | NO | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 수정일 |

---

### 1.5. SubComments (대댓글)

| 속성명 | 데이터 타입 | NULL 허용 | 제약조건 | 설명 |
|--------|-------------|-----------|-----------|------|
| subcomment_id | INT | NO | PK, AUTO_INCREMENT | 대댓글 ID |
| comment_id | INT | NO | FK → Comments.comment_id | 상위 댓글 |
| user_id | INT | NO | FK → Users.user_id | 작성자 |
| content | TEXT | NO | - | 대댓글 내용 |
| created_at | DATETIME | NO | DEFAULT CURRENT_TIMESTAMP | 작성일 |
| updated_at | DATETIME | NO | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 수정일 |

---

### 1.6. Likes (좋아요)

| 속성명 | 데이터 타입 | NULL 허용 | 제약조건 | 설명 |
|--------|-------------|-----------|-----------|------|
| like_id | INT | NO | PK, AUTO_INCREMENT | 좋아요 ID |
| post_id | INT | NO | FK → Posts.post_id | 게시글 |
| user_id | INT | NO | FK → Users.user_id | 사용자 |
| created_at | DATETIME | NO | DEFAULT CURRENT_TIMESTAMP | 누른 시각 |

**비지니스 규칙:**
- UNIQUE(post_id, user_id)
- 게시물 삭제 시 자동 삭제.

---

### 1.7. Follows (팔로우)

| 속성명 | 데이터 타입 | NULL 허용 | 제약조건 | 설명 |
|--------|-------------|-----------|-----------|------|
| follow_id | INT | NO | PK, AUTO_INCREMENT | 팔로우 ID |
| sender_id | INT | NO | FK → Users.user_id | 팔로우 하는 사람 |
| receiver_id | INT | NO | FK → Users.user_id | 팔로우 받는 사람 |
| created_at | DATETIME | NO | DEFAULT CURRENT_TIMESTAMP | 팔로우 시각 |

**비지니스 규칙:**
- UNIQUE(sender_id, receiver_id)
- 자기자신을 팔로우 불가 (App 레벨)

---

### 1.8. ChatRooms (채팅방)

| 컬럼명 | 타입 | 설명 |
| --- | --- | --- |
| `chatroom_id` | INT, PK, AUTO_INCREMENT | 채팅방 고유 ID |
| `name` | VARCHAR(255) | 채팅방 이름 (자동 생성 가능) |
| `is_group` | BOOLEAN, DEFAULT FALSE | 그룹 여부 |
| `creator_id` | INT, FK → Users.user_id | 방 생성자 |
| `last_message` | TEXT | 마지막 메시지 미리보기용 |
| `last_message_at` | DATETIME | 최근 메시지 시각 (정렬 기준) |
| `created_at` | DATETIME, DEFAULT CURRENT_TIMESTAMP | 생성 시각 |
---


### 1.9. ChatParticipants (채팅 참가자)

| 컬럼명 | 타입 | 설명 |
| --- | --- | --- |
| `id` | INT, PK, AUTO_INCREMENT | 참가자 레코드 ID |
| `chatroom_id` | INT, FK → ChatRooms.chatroom_id | 채팅방 |
| `user_id` | INT, FK → Users.user_id | 사용자 |
| `status` | ENUM('JOINED','LEFT') | 참여 상태 |
| `joined_at` | DATETIME, DEFAULT CURRENT_TIMESTAMP | 입장 시각 |
| `left_at` | DATETIME, NULL | 퇴장 시각 |

**비지니스 규칙:**
- UNIQUE(chatroom_id, user_id)
- 채팅방 삭제 시 연속 삭제

---

### 1.10. Messages (메시지)

| 속성명 | 데이터 타입 | NULL 허용 | 제약조건 | 설명 |
|--------|-------------|-----------|-----------|------|
| message_id | INT | NO | PK, AUTO_INCREMENT | 메시지 ID |
| chatroom_id | INT | NO | FK → ChatRooms.chatroom_id | 채팅방 |
| sender_id | INT | NO | FK → Users.user_id | 보낸 사람 |
| content | TEXT | NO | - | 메시지 내용 |
| sent_at | DATETIME | NO | DEFAULT CURRENT_TIMESTAMP | 전송 시각 |

---

## 2. 엔티티 간 관계 분석

| 관계명 | 엔티티1 | 엔티티2 | 관계유형 | 설명 |
|--------|----------|----------|-----------|------|
| 작성 | Users | Posts | 1:N | 한 사용자는 여러 게시물 작성 가능 |
| 포함 | Posts | Media | 1:N | 한 게시글에 여러 미디어 포함 |
| 댓글 | Posts | Comments | 1:N | 게시글당 여러 댓글 |
| 대댓글 | Comments | SubComments | 1:N | 댓글당 여러 대댓글 |
| 좋아요 | Users | Likes | 1:N | 사용자는 여러 게시물 좋아요 가능 |
| 팔로우 | Users | Follows | 1:N (self) | 사용자가 다른 사용자 팔로우 |
| 참가 | ChatRooms | ChatParticipants | 1:N | 채팅방에 여러 참가자 존재 |
| 메시지 | ChatRooms | Messages | 1:N | 채팅방당 여러 메시지 존재 |
| 발신 | Users | Messages | 1:N | 사용자가 